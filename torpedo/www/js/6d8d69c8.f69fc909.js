(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["6d8d69c8"],{"2f21":function(t,e,a){"use strict";var i=a("79e5");t.exports=function(t,e){return!!t&&i(function(){e?t.call(null,function(){},1):t.call(null)})}},"55dd":function(t,e,a){"use strict";var i=a("5ca1"),s=a("d8e8"),n=a("4bf8"),r=a("79e5"),o=[].sort,l=[1,2,3];i(i.P+i.F*(r(function(){l.sort(void 0)})||!r(function(){l.sort(null)})||!a("2f21")(o)),"Array",{sort:function(t){return void 0===t?o.call(n(this)):o.call(n(this),s(t))}})},8041:function(t,e,a){"use strict";var i=a("d924"),s=a.n(i);s.a},"8b24":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-page",{staticClass:"flex flex-center"},[a("div",{staticClass:"column self-start justify-center"},[a("div",{staticClass:"row q-gutter-md q-my-md"},[a("q-card",{staticClass:"q-mr-md"},[a("q-card-section",[a("q-scroll-area",{staticStyle:{width:"350px",height:"500px"}},[a("q-markup-table",{attrs:{flat:"",separator:"vertical"}},[a("thead",[a("tr",[a("th",{staticClass:"text-left"},[t._v("倾角读数 (°)")]),a("th",{staticClass:"text-right"},[t._v("实际比重 ("+t._s("p"===t.regData.unit?"°P":"SG")+")")]),a("th",{staticClass:"text-right"},[t._v("拟合误差 ("+t._s("p"===t.regData.unit?"°P":"SG")+")")])])]),a("tbody",t._l(t.tiltData,function(e,i){return a("tr",{key:i},[a("td",{staticClass:"text-left"},[t._v(t._s(e[0].toFixed(2))+"°")]),a("td",{staticClass:"text-right"},[t._v(t._s(e[1].toFixed(3))+t._s("p"===t.regData.unit?"°P":"SG"))]),a("td",{staticClass:"text-right"},[t._v(t._s(t.calcError(e[0],e[1])))])])}),0)])],1)],1)],1),a("q-card",[a("q-card-section",[a("div",{staticStyle:{width:"550px",height:"500px"},attrs:{id:"theChart"}})])],1)],1),a("div",[a("q-card",[a("q-card-section",[a("div",{staticClass:"row q-gutter-md"},[a("q-toggle",{attrs:{label:"比重单位: "+("p"===t.regData.unit?"°P":"SG"),color:"deep-orange","false-value":"sg","true-value":"p",disable:t.tiltData.length>0,"left-label":"","keep-color":""},model:{value:t.regData.unit,callback:function(e){t.$set(t.regData,"unit",e)},expression:"regData.unit"}}),a("q-input",{staticStyle:{width:"140px","font-size":"24px"},attrs:{readonly:"",dense:"",outlined:"",type:"number",label:"倾角读数","input-class":"text-right"},scopedSlots:t._u([{key:"append",fn:function(){return[t._v("°")]},proxy:!0}]),model:{value:t.currentTiltAngle,callback:function(e){t.currentTiltAngle=t._n(e)},expression:"currentTiltAngle"}},[a("q-tooltip",[t._v("自动读取，无需填写")])],1),a("q-input",{staticStyle:{width:"140px","font-size":"24px"},attrs:{autofocus:"",outlined:"",dense:"",type:"number",label:"比重读数","input-class":"text-right"},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handleAddBtn(e)}},scopedSlots:t._u([{key:"append",fn:function(){return[t._v(t._s("p"===t.regData.unit?"°P":"SG"))]},proxy:!0}]),model:{value:t.currentGravityReading,callback:function(e){t.currentGravityReading=t._n(e)},expression:"currentGravityReading"}},[a("q-tooltip",[t._v("填写比重计实际读数")])],1),a("q-btn",{staticClass:"self-center q-ml-sm",attrs:{color:"deep-orange",dense:"",size:"lg",round:"",flat:"",icon:"add_circle_outline"},on:{click:t.handleAddBtn}},[a("q-tooltip",[t._v("添加新数据")])],1),a("q-btn",{staticClass:"self-center q-ml-none",attrs:{color:"blue-9",dense:"",size:"lg",round:"",flat:"",icon:"remove_circle_outline"},on:{click:t.handleRemoveBtn}},[a("q-tooltip",[t._v("删除前一笔数据")])],1),a("q-space"),a("q-toggle",{attrs:{label:"校准助手"},model:{value:t.guideIsOn,callback:function(e){t.guideIsOn=e},expression:"guideIsOn"}}),a("q-toggle",{attrs:{label:"温度修正",disable:t.tiltData.length>0},model:{value:t.tempCorrectionIsOn,callback:function(e){t.tempCorrectionIsOn=e},expression:"tempCorrectionIsOn"}}),a("q-btn",{attrs:{disable:t.tiltData.length<5,color:"deep-orange",flat:"",dense:"",size:"xl",icon:"save"},on:{click:t.handleSaveBtn}},[a("q-tooltip",[t._v("保存校准结果")])],1),a("q-btn",{attrs:{color:"deep-orange",flat:"",dense:"",size:"xl",icon:"assignment"},on:{click:t.handleLoadParamsBtn}},[a("q-tooltip",[t._v("调取已保存的校准参数")])],1)],1)])],1)],1)]),a("q-dialog",{attrs:{persistent:""},model:{value:t.guidePopUp,callback:function(e){t.guidePopUp=e},expression:"guidePopUp"}},[a("q-card",{staticStyle:{width:"300px"}},[a("q-card-section",[a("div",{staticClass:"text-h6"},[t._v("校准助手")])]),a("q-card-section",[a("q-input",{staticStyle:{"font-size":"24px",width:"95%"},attrs:{type:"number",label:"请输入校准所使用的清水容量","input-class":"text-right",dense:""},scopedSlots:t._u([{key:"append",fn:function(){return[t._v("ml")]},proxy:!0}]),model:{value:t.plainWaterMl,callback:function(e){t.plainWaterMl=t._n(e)},expression:"plainWaterMl"}})],1),a("q-card-actions",{staticClass:"text-deep-orange",attrs:{align:"right"}},[a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"取消"},on:{click:function(e){t.guideIsOn=!1}}}),a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"确定",disable:!t.plainWaterMl},on:{click:function(e){return t.showGuideNotify()}}})],1)],1)],1),a("q-dialog",{attrs:{persistent:""},model:{value:t.tempCorrectionPopUp,callback:function(e){t.tempCorrectionPopUp=e},expression:"tempCorrectionPopUp"}},[a("q-card",{staticStyle:{width:"300px"}},[a("q-card-section",[a("div",{staticClass:"text-h6"},[t._v("温度修正")])]),a("q-card-section",[a("q-input",{staticStyle:{"font-size":"24px",width:"95%"},attrs:{type:"number",label:"比重计校准温度",hint:"玻璃比重计读数的校准温度","input-class":"text-right",dense:""},scopedSlots:t._u([{key:"append",fn:function(){return[t._v("℃")]},proxy:!0}]),model:{value:t.hydrometerBaseTemp,callback:function(e){t.hydrometerBaseTemp=t._n(e)},expression:"hydrometerBaseTemp"}})],1),a("q-card-section",[a("q-input",{staticStyle:{"font-size":"24px",width:"95%"},attrs:{type:"number",label:"样本溶液温度",hint:"当前调配的糖溶液的温度","input-class":"text-right",dense:""},scopedSlots:t._u([{key:"append",fn:function(){return[t._v("℃")]},proxy:!0}]),model:{value:t.sampleTemp,callback:function(e){t.sampleTemp=t._n(e)},expression:"sampleTemp"}})],1),a("q-card-actions",{staticClass:"text-deep-orange",attrs:{align:"right"}},[a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"取消"},on:{click:function(e){t.tempCorrectionIsOn=!1}}}),a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"确定",disable:!t.hydrometerBaseTemp||!t.sampleTemp}})],1)],1)],1),a("q-dialog",{model:{value:t.lastSavedParamsPopUp,callback:function(e){t.lastSavedParamsPopUp=e},expression:"lastSavedParamsPopUp"}},[a("q-card",[a("q-card-section",[a("div",{staticClass:"text-h6"},[t._v("已保存的校准结果")])]),a("q-card-section",[a("div",{staticClass:"text-caption"},[t._v(t._s("**请注意回归公式的单位为："+("p"===this.lastSavedRegData.unit?"Plato 糖度":"SG 比重")))])]),a("q-card-section",[a("div",{staticClass:"text-h6"},[t._v(t._s(("p"===this.lastSavedRegData.unit?"Plato":"SG")+" = "+this.lastSavedRegData.a+"·Tilt² "+(this.lastSavedRegData.b>=0?"+":"-")+" "+Math.abs(this.lastSavedRegData.b)+"·Tilt "+(this.lastSavedRegData.c>=0?"+":"-")+" "+Math.abs(this.lastSavedRegData.c)))])])],1)],1)],1)},s=[],n=(a("c5f6"),a("55dd"),{name:"PageIndex",created:function(){var t=this;this.handleTiltDataStorage("load"),setInterval(function(){t.updateCurrentTiltAngle()},7e3)},mounted:function(){this.drawChart()},methods:{drawChart:function(){var t=this;this.myRegression=this.$ecstat.regression("polynomial",this.tiltData,2),this.myRegression.points.sort(function(t,e){return t[0]-e[0]});var e=this.$echarts.init(document.getElementById("theChart")),a={tooltip:{trigger:"axis",axisPointer:{type:"cross"}},title:{text:this.chartTitle,subtext:this.formula,subtextStyle:{color:"navy",fontStyle:"italic"},left:"center",top:16},xAxis:{type:"value",name:this.xAxisLabel,nameLocation:"middle",nameGap:30,axisLabel:{formatter:"{value}°"},min:function(t){return Math.floor(.9*t.min)},splitLine:{lineStyle:{type:"dashed"}},splitNumber:10},yAxis:{type:"value",name:this.yAxisLabel,nameLocation:"end",nameGap:18,axisLabel:{formatter:function(e,a){return"p"===t.regData.unit?e.toFixed(1)+" °P":e.toFixed(3)+" SG"}},min:function(e){return"p"===t.regData.unit?0:.99},splitLine:{lineStyle:{type:"dashed"}},splitNumber:10},series:[{name:"scatter",type:"scatter",label:{emphasis:{show:!0}},data:this.tiltData},{name:"line",type:"line",smooth:!0,showSymbol:!1,data:this.myRegression.points,markPoint:{itemStyle:{normal:{color:"transparent"}},label:{normal:{show:!0,position:"left",formatter:this.myRegression.expression,textStyle:{color:"#333",fontSize:14}}},data:[{coord:this.myRegression.points[this.myRegression.points.length-1]}]}}]};e.setOption(a),this.regData.a=this.myRegression.parameter[2],this.regData.b=this.myRegression.parameter[1],this.regData.c=this.myRegression.parameter[0]},calcError:function(t,e){if(this.regData.a&&this.regData.b&&this.regData.c){var a=this.regData.a*t*t+this.regData.b*t+this.regData.c;return(a-e).toFixed(3)}return null},tempCorrectedGravity:function(t){var e;e="p"===this.regData.unit?this.calcSgFromPlato(t):t;var a=this.calcFahrenheitFromCelsius(this.hydrometerBaseTemp),i=this.calcFahrenheitFromCelsius(this.sampleTemp),s=e*((1.00130346-.000134722124*i+204052596e-14*i*i-2.32820948e-9*i*i*i)/(1.00130346-.000134722124*a+204052596e-14*a*a-2.32820948e-9*a*a*a));return"p"===this.regData.unit?this.calcPlatoFromSg(s):s},handleAddBtn:function(){var t;this.currentTiltAngle&&Number(this.currentGravityReading)>=0&&(t=this.tempCorrectionIsOn?this.tempCorrectedGravity(Number(this.currentGravityReading)):Number(this.currentGravityReading),this.tiltData.push([Number(this.currentTiltAngle),t]),this.currentGravityReading=null,this.drawChart(),this.showGuideNotify(),this.handleTiltDataStorage("save"))},handleRemoveBtn:function(){var t=this.tiltData.length-1;t>=0&&(this.tiltData.splice(t,1),this.drawChart(),this.showGuideNotify(),this.handleTiltDataStorage("save"))},handleSaveBtn:function(){var t=this;this.tiltData.length>4&&(this.$axios.post("/calibration",this.regData).then(function(e){t.$q.notify({color:"info",icon:"check_circle_outline",message:"已成功保存校准参数!"})}).catch(function(e){console.log(e),t.$q.notify({color:"negative",icon:"error_outline",message:"Error: 保存校准参数失败!"})}),console.log(this.regData))},handleLoadParamsBtn:function(){var t=this;this.$axios.get("/calibration").then(function(e){t.lastSavedRegData=e.data.params,t.lastSavedParamsPopUp=!0,t.dismissTiltAngleErrorNotify&&t.dismissTiltAngleErrorNotify()}).catch(function(e){console.log(e),t.dismissTiltAngleErrorNotify||(t.dismissTiltAngleErrorNotify=t.$q.notify({color:"negative",icon:"error_outline",timeout:0,message:"Error: 无法获取已保存的校准参数!"}))})},updateCurrentTiltAngle:function(){var t=this;this.$axios.get("/tilt").then(function(e){t.currentTiltAngle=e.data.tilt.toFixed(2),t.dismissTiltAngleErrorNotify&&t.dismissTiltAngleErrorNotify()}).catch(function(e){console.log(e),t.dismissTiltAngleErrorNotify||(t.dismissTiltAngleErrorNotify=t.$q.notify({color:"negative",icon:"error_outline",timeout:0,message:"Error: 获取比重计倾角数据失败!"}))})},showGuideNotify:function(){var t;this.dismissGuideNotify&&this.dismissGuideNotify();var e=0,a=this.tiltData.length,i=[0,20,15,10,7.5,5,2.5];for(var s in this.totalWeight=Number(this.plainWaterMl),i)if(s>0&&(e=this.platoCalc(i[s-1],i[s],this.totalWeight),this.totalWeight+=e,Number(s)===a))break;var n=i[a],r=this.calcSgFromPlato(n).toFixed(3);t=0===a?"第".concat(a+1,"步：将电子比重计置于").concat(this.plainWaterMl,"毫升清水中，并记下传统比重计读数（如：").concat(n,"°P，").concat(r,"SG）。"):1===a?"第".concat(a+1,"步：向").concat(this.plainWaterMl,"毫升清水中溶入").concat(Math.round(e),"克白砂糖，使其比重达到约").concat(n,"°P或").concat(r,"SG，并记下传统比重计的实际读数。"):a===i.length?"校准完成：请点击保存按钮保存校准参数。":"第".concat(a+1,"步：往上一步调制的糖溶液中加入").concat(Math.round(e),"毫升清水，将其稀释至约").concat(n,"°P或").concat(r,"SG，并记下传统比重计的实际读数。"),a<i.length+1&&this.guideIsOn&&(this.dismissGuideNotify=this.$q.notify({message:t,color:"negative",textColor:"white",icon:"flag",position:"top-right",timeout:0,multiLine:!1,actions:[{label:"朕知道了",color:"yellow"}],classes:"guideStyle"}))},calcSgFromPlato:function(t){return 1+t/(258.6-t/258.2*227.1)},calcPlatoFromSg:function(t){return 1111.14*t-616.868-630.272*t*t+135.997*t*t*t},calcFahrenheitFromCelsius:function(t){return 1.8*t+32},handleTiltDataStorage:function(t){"save"===t?this.$q.sessionStorage.set("storedTiltData",this.tiltData):"load"===t&&this.$q.sessionStorage.has("storedTiltData")&&(this.tiltData=this.$q.sessionStorage.getItem("storedTiltData"))},platoCalc:function(t,e,a){var i=e-t;return i>0?a*i/100/(1-e/100):a*t/e-a}},watch:{guideIsOn:function(){this.guideIsOn&&(this.guidePopUp=!0)},tempCorrectionIsOn:function(){this.tempCorrectionIsOn&&(this.tempCorrectionPopUp=!0)}},computed:{formula:function(){return this.tiltData.length>2?"Y = ".concat(this.myRegression.parameter[2].toFixed(8),"·X² ").concat(this.myRegression.parameter[1]>=0?"+":"-"," ").concat(Math.abs(this.myRegression.parameter[1].toFixed(8)),"·X ").concat(this.myRegression.parameter[0]>=0?"+":"-"," ").concat(Math.abs(this.myRegression.parameter[0].toFixed(8))):""}},data:function(){return{currentTiltAngle:null,currentGravityReading:null,myRegression:null,regData:{unit:"p",a:null,b:null,c:null},lastSavedRegData:{unit:null,a:null,b:null,c:null},chartTitle:"Tilt-Gravity Regression",xAxisLabel:"Tilt Degree (°)",yAxisLabel:"Gravity",tiltData:[],dismissGuideNotify:null,dismissTiltAngleErrorNotify:null,guideIsOn:!1,guidePopUp:!1,plainWaterMl:400,totalWeight:null,tempCorrectionIsOn:!1,tempCorrectionPopUp:!1,lastSavedParamsPopUp:!1,sampleTemp:null,hydrometerBaseTemp:20}}}),r=n,o=(a("8041"),a("2877")),l=Object(o["a"])(r,i,s,!1,null,null,null);e["default"]=l.exports},d924:function(t,e,a){}}]);