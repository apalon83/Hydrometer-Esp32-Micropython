(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["2d22c0ff"],{f241:function(t,e,n){"use strict";n.r(e);var s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("q-layout",{attrs:{view:"lHh Lpr lFf"}},[n("q-header",{attrs:{elevated:""}},[n("q-toolbar",{staticClass:"bg-deep-orange"},[n("q-btn",{attrs:{flat:"",dense:"",round:"","aria-label":"Settings"},on:{click:t.handleSettingsBtn}},[n("q-icon",{attrs:{name:"build"}})],1),n("q-toolbar-title",[t._v("\n        无线电子比重计 - 校准模式\n      ")])],1)],1),n("q-drawer",{attrs:{bordered:"","content-class":"bg-grey-2"},model:{value:t.leftDrawerOpen,callback:function(e){t.leftDrawerOpen=e},expression:"leftDrawerOpen"}},[n("q-list",[n("q-item-label",{attrs:{header:""}},[t._v("设置选项")]),n("q-item",[n("q-item-section",{attrs:{avatar:""}},[n("q-icon",{attrs:{name:"account_circle"}})],1),n("q-item-section",[n("q-item-label",[t._v("无线SSID")]),n("q-item-label",[n("q-input",{attrs:{outlined:"",dense:"",rules:[function(t){return!!t||"此项为必填项"}]},model:{value:t.settings.apSsid,callback:function(e){t.$set(t.settings,"apSsid",e)},expression:"settings.apSsid"}})],1)],1)],1),n("q-separator",{attrs:{spaced:""}}),n("q-item",[n("q-item-section",{attrs:{avatar:""}},[n("q-icon",{attrs:{name:"wifi"}})],1),n("q-item-section",[n("q-item-label",[t._v("WiFi热点")]),n("q-item-label",[n("q-select",{attrs:{outlined:"",options:t.settings.wifiList,dense:"","options-dense":""},model:{value:t.settings.wifi.ssid,callback:function(e){t.$set(t.settings.wifi,"ssid",e)},expression:"settings.wifi.ssid"}})],1),n("q-item-label",[n("q-input",{attrs:{outlined:"",type:t.isPwd?"password":"text",dense:""},scopedSlots:t._u([{key:"append",fn:function(){return[n("q-icon",{staticClass:"cursor-pointer",attrs:{name:t.isPwd?"visibility_off":"visibility"},on:{click:function(e){t.isPwd=!t.isPwd}}})]},proxy:!0}]),model:{value:t.settings.wifi.pass,callback:function(e){t.$set(t.settings.wifi,"pass",e)},expression:"settings.wifi.pass"}})],1)],1),n("q-item-section",{attrs:{avatar:""}},[n("q-item-label",[t._v(" ")]),n("q-item-label",[n("q-btn",{attrs:{dense:"",round:"",color:"deep-orange",icon:"refresh"},on:{click:t.handleWifiRefreshBtn}},[n("q-tooltip",{attrs:{anchor:"bottom middle",self:"top middle"}},[t._v("\n                刷新WiFi列表\n              ")])],1)],1),n("q-item-label",[n("q-btn",{attrs:{dense:"",disable:!this.settings.wifi.ssid,round:"",color:"deep-orange",icon:"rss_feed"},on:{click:t.handleWifiConnectBtn}},[n("q-tooltip",{attrs:{anchor:"bottom middle",self:"top middle"}},[t._v("\n                连接WiFi热点\n              ")])],1)],1)],1)],1),n("q-separator",{attrs:{spaced:""}}),n("q-item",[n("q-item-section",{attrs:{avatar:""}},[n("q-icon",{attrs:{name:"cloud_upload"}})],1),n("q-item-section",[n("q-item-label",[t._v("开启FTP服务")]),n("q-item-label",{attrs:{caption:""}},[t._v("ftp://192.168.4.1:21")])],1),n("q-item-section",{attrs:{avatar:""}},[n("q-btn",{attrs:{round:"",dense:"",color:"deep-orange",icon:"create_new_folder"},on:{click:t.handleFtpConnectBtn}},[n("q-tooltip",{attrs:{anchor:"bottom middle",self:"top middle"}},[t._v("\n              开启FTP服务\n            ")])],1)],1)],1),n("q-separator",{attrs:{spaced:""}}),n("q-item",[n("q-item-section",{attrs:{avatar:""}},[n("q-icon",{attrs:{name:"search"}})],1),n("q-item-section",[n("q-item-label",[t._v("将数据发送至...")]),n("q-item-label",[n("div",{staticClass:"row justify-center"},[n("q-toggle",{attrs:{"checked-icon":"check",color:"red","unchecked-icon":"clear",label:"发酵箱","left-label":""},model:{value:t.settings.fermenterAp.enabled,callback:function(e){t.$set(t.settings.fermenterAp,"enabled",e)},expression:"settings.fermenterAp.enabled"}}),n("q-toggle",{attrs:{"checked-icon":"check",color:"red","unchecked-icon":"clear",label:"MQTT","left-label":""},model:{value:t.settings.mqtt.enabled,callback:function(e){t.$set(t.settings.mqtt,"enabled",e)},expression:"settings.mqtt.enabled"}})],1)])],1)],1),n("q-separator",{attrs:{spaced:""}}),n("q-item",{directives:[{name:"show",rawName:"v-show",value:t.settings.fermenterAp.enabled,expression:"settings.fermenterAp.enabled"}]},[n("q-item-section",[n("q-item-label",[n("q-icon",{staticClass:"q-mr-lg",attrs:{name:"settings_remote",size:"26px"}}),n("span",{staticClass:"q-ml-sm"},[t._v("发酵箱AP设置")])],1),n("q-item-label",[n("q-select",{attrs:{outlined:"",options:t.settings.wifiList,disable:!t.settings.fermenterAp.enabled,dense:"","options-dense":""},model:{value:t.settings.fermenterAp.ssid,callback:function(e){t.$set(t.settings.fermenterAp,"ssid",e)},expression:"settings.fermenterAp.ssid"}})],1),n("q-item-label",[n("q-input",{attrs:{outlined:"",type:t.isPwd?"password":"text",disable:!t.settings.fermenterAp.enabled,dense:""},scopedSlots:t._u([{key:"append",fn:function(){return[n("q-icon",{staticClass:"cursor-pointer",attrs:{name:t.isPwd?"visibility_off":"visibility"},on:{click:function(e){t.isPwd=!t.isPwd}}})]},proxy:!0}]),model:{value:t.settings.fermenterAp.pass,callback:function(e){t.$set(t.settings.fermenterAp,"pass",e)},expression:"settings.fermenterAp.pass"}})],1)],1),n("q-item-section",{attrs:{avatar:""}},[n("q-item-label",[t._v("  ")]),n("q-item-label",[n("q-btn",{staticClass:"q-mt-sm",attrs:{dense:"",disable:!t.settings.fermenterAp.enabled,round:"",color:"deep-orange",icon:"refresh"},on:{click:t.handleWifiRefreshBtn}},[n("q-tooltip",{attrs:{anchor:"bottom middle",self:"top middle"}},[t._v("\n                刷新AP列表\n              ")])],1)],1),n("q-item-label",[n("q-btn",{attrs:{dense:"",disable:!this.settings.fermenterAp.ssid,round:"",color:"deep-orange",icon:"speaker_phone"},on:{click:t.handleFermenterConnectBtn}},[n("q-tooltip",{attrs:{anchor:"bottom middle",self:"top middle"}},[t._v("\n                连接发酵箱AP\n              ")])],1)],1)],1)],1),n("q-item",{directives:[{name:"show",rawName:"v-show",value:t.settings.mqtt.enabled,expression:"settings.mqtt.enabled"}]},[n("q-item-section",[n("q-item-label",[n("q-icon",{staticClass:"q-mr-lg",attrs:{name:"insert_chart",size:"26px"}}),n("span",{staticClass:"q-ml-sm"},[t._v("MQTT设置")])],1),n("q-item-label",[n("div",{staticClass:"row justify-between"},[n("q-input",{staticStyle:{width:"69%"},attrs:{dense:"",outlined:"",label:"Broker地址",disable:!t.settings.mqtt.enabled},model:{value:t.settings.mqtt.brokerAddr,callback:function(e){t.$set(t.settings.mqtt,"brokerAddr",e)},expression:"settings.mqtt.brokerAddr"}}),n("q-input",{staticStyle:{width:"29%"},attrs:{dense:"",outlined:"",label:"端口",disable:!t.settings.mqtt.enabled},model:{value:t.settings.mqtt.brokerPort,callback:function(e){t.$set(t.settings.mqtt,"brokerPort",e)},expression:"settings.mqtt.brokerPort"}})],1)]),n("q-item-label",[n("q-input",{attrs:{dense:"",outlined:"",label:"用户名",disable:!t.settings.mqtt.enabled},model:{value:t.settings.mqtt.username,callback:function(e){t.$set(t.settings.mqtt,"username",e)},expression:"settings.mqtt.username"}})],1),n("q-item-label",[n("q-input",{attrs:{dense:"",outlined:"",label:"密码",type:t.isPwd?"password":"text",disable:!t.settings.mqtt.enabled},scopedSlots:t._u([{key:"append",fn:function(){return[n("q-icon",{staticClass:"cursor-pointer",attrs:{name:t.isPwd?"visibility_off":"visibility"},on:{click:function(e){t.isPwd=!t.isPwd}}})]},proxy:!0}]),model:{value:t.settings.mqtt.password,callback:function(e){t.$set(t.settings.mqtt,"password",e)},expression:"settings.mqtt.password"}})],1),n("q-item-label",[n("q-input",{attrs:{dense:"",outlined:"",label:"Topic",disable:!t.settings.mqtt.enabled},model:{value:t.settings.mqtt.topic,callback:function(e){t.$set(t.settings.mqtt,"topic",e)},expression:"settings.mqtt.topic"}})],1),n("q-item-label",{staticClass:"row justify-end"},[n("q-btn",{attrs:{dense:"",disable:!t.settings.mqtt.brokerAddr||!t.settings.mqtt.brokerPort||!t.settings.mqtt.username||!t.settings.mqtt.topic,round:"",color:"deep-orange",icon:"speaker_notes"},on:{click:t.handleMqttTestBtn}})],1)],1)],1),n("q-separator",{attrs:{spaced:""}}),n("q-item",[n("q-item-section",{attrs:{avatar:""}},[n("q-icon",{attrs:{name:"restore"}})],1),n("q-item-section",[n("q-item-label",[t._v("唤醒采样频率")]),n("q-item-label",[n("q-input",{staticClass:"text-h5",attrs:{outlined:"",type:"number","input-class":"text-right",dense:"",rules:[function(t){return!!t||"此项为必填项"},function(t){return t>=5||"采样频率建议在5-60分钟之间"},function(t){return t<=60||"采样频率建议在5-60分钟之间"}]},scopedSlots:t._u([{key:"prepend",fn:function(){return[t._v("\n                每\n              ")]},proxy:!0},{key:"append",fn:function(){return[t._v("\n                分钟\n              ")]},proxy:!0}]),model:{value:t.deepSleepIntervalMinute,callback:function(e){t.deepSleepIntervalMinute=e},expression:"deepSleepIntervalMinute"}})],1)],1)],1),n("q-separator",{attrs:{spaced:""}}),n("q-item",{staticClass:"q-mt-sm"},[n("q-item-section",{staticClass:"q-mr-sm"},[n("q-btn",{attrs:{glossy:"",unelevated:"",color:"deep-orange",icon:"autorenew",label:"重 启",size:"md"},on:{click:t.handleRebootBtn}},[n("q-tooltip",[t._v("\n              重启后将进入工作模式\n            ")])],1)],1),n("q-item-section",[n("q-btn",{attrs:{glossy:"",unelevated:"",color:"deep-orange",icon:"save",label:"保 存",size:"md",disable:!(t.settings.apSsid&&t.deepSleepIntervalMinute)},on:{click:t.handleSaveSettingsBtn}},[n("q-tooltip",[t._v("\n              保存设置选项\n            ")])],1)],1)],1)],1)],1),n("q-page-container",{staticClass:"bg-grey-2"},[n("router-view")],1)],1)},i=[],o=(n("c5f6"),n("0967"),n("2b0e"),{name:"MyLayout",watch:{fermenterApEnabled:function(){this.settings.fermenterAp.enabled?this.settings.mqtt.enabled=!1:this.settings.mqtt.enabled=!0},mqttEnabled:function(){this.settings.mqtt.enabled?this.settings.fermenterAp.enabled=!1:this.settings.fermenterAp.enabled=!0}},computed:{fermenterApEnabled:function(){return this.settings.fermenterAp.enabled},mqttEnabled:function(){return this.settings.mqtt.enabled},deepSleepIntervalMinute:{get:function(){return Math.ceil(this.settings.deepSleepIntervalMs/1e3/60)},set:function(t){this.settings.deepSleepIntervalMs=60*t*1e3}}},data:function(){return{leftDrawerOpen:!1,isPwd:!0,rebootBtnIsDisabled:!0,settings:{apSsid:"Hydrometer",wifi:{ssid:"",pass:""},fermenterAp:{enabled:!0,ssid:"",pass:""},deepSleepIntervalMs:9e5,wifiList:["28#301","28#301_ASUS","Fermenter","ChinaNet1234","ChinaNet4542","UnionCom8876"],mqtt:{enabled:!1,brokerAddr:"",brokerPort:1883,username:"",password:"",topic:""}}}},created:function(){setTimeout(this.loadSettings,1e4)},methods:{handleSettingsBtn:function(){this.leftDrawerOpen||this.loadSettings(),this.leftDrawerOpen=!this.leftDrawerOpen},loadSettings:function(){var t=this;this.$axios.get("/settings").then(function(e){t.settings=e.data}).catch(function(e){console.log(e),t.$q.notify({color:"negative",icon:"error_outline",message:"Error: 无法从后台获取设置选项数据!"})})},handleWifiRefreshBtn:function(){var t=this;this.$axios.get("/wifi").then(function(e){t.settings.wifiList=e.data.wifiList}).catch(function(e){console.log(e),t.$q.notify({color:"negative",icon:"signal_wifi_off",message:"Error: 无法刷新WiFi热点列表!"})})},handleWifiConnectBtn:function(){var t=this;this.$axios.post("/wifi",this.settings.wifi).then(function(e){t.$q.notify({color:"info",icon:"signal_wifi_4_bar_lock",message:"已成功连接WiFi热点“".concat(t.settings.wifi.ssid,"”!")})}).catch(function(e){console.log(e),t.$q.notify({color:"negative",icon:"signal_wifi_off",message:"Error: 无法连接WiFi热点“".concat(t.settings.wifi.ssid,"”!")})})},handleFtpConnectBtn:function(){var t=this;this.$axios.get("/ftp").then(function(e){t.$q.notify({color:"info",icon:"check_circle_outline",message:"FTP服务已经开启!"})}).catch(function(e){console.log(e),t.$q.notify({color:"negative",icon:"error_outline",message:"Error: 无法开启FTP服务!"})})},handleFermenterConnectBtn:function(){var t=this;this.$axios.post("/wifi",this.settings.fermenterAp).then(function(e){t.$q.notify({color:"info",icon:"signal_wifi_4_bar_lock",message:"已成功连接发酵箱AP信号“".concat(t.settings.fermenterAp.ssid,"”!")})}).catch(function(e){console.log(e),t.$q.notify({color:"negative",icon:"signal_wifi_off",message:"Error: 无法连接发酵箱AP信号“".concat(t.settings.fermenterAp.ssid,"”!")})})},handleMqttTestBtn:function(){var t=this;this.$axios.post("/mqtttest",{mqtt:this.settings.mqtt}).then(function(e){t.$q.notify({color:"info",icon:"check_circle_outline",message:"已成功向MQTT服务器发送测试数据!"}),t.rebootBtnIsDisabled=!1}).catch(function(e){console.log(e),t.$q.notify({color:"negative",icon:"error_outline",message:"Error: 发送测试数据失败!"})})},handleSaveSettingsBtn:function(){var t=this;console.log(this.settings),this.$axios.post("/settings",{apSsid:this.settings.apSsid,wifi:this.settings.wifi,fermenterAp:this.settings.fermenterAp,mqtt:this.settings.mqtt,deepSleepIntervalMs:Number(this.settings.deepSleepIntervalMs)}).then(function(e){t.$q.notify({color:"info",icon:"check_circle_outline",message:"已成功保存设置选项! 请重启设备!"}),t.rebootBtnIsDisabled=!1}).catch(function(e){console.log(e),t.$q.notify({color:"negative",icon:"error_outline",message:"Error: 保存设置选项失败!"})})},handleRebootBtn:function(){this.confirmReboot()},confirmReboot:function(){var t=this;this.$q.dialog({title:"确认重启设备",message:"是否确认要重启设备的主控板？",ok:{push:!0},cancel:{push:!0,color:"negative"},persistent:!0}).onOk(function(){t.$axios.get("/deepsleep").then(function(e){t.$q.notify({color:"info",icon:"autorenew",message:"正在重启设备，请稍候..."})}).catch(function(e){console.log(e),t.$q.notify({color:"negative",icon:"error_outline",message:"Error: 无法与主控板通讯，未能重启设备!"})})}).onCancel(function(){})}}}),a=o,r=n("2877"),l=Object(r["a"])(a,s,i,!1,null,null,null);e["default"]=l.exports}}]);