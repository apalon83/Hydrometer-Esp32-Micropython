(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["6d8d69c8"],{"2f21":function(t,e,i){"use strict";var a=i("79e5");t.exports=function(t,e){return!!t&&a(function(){e?t.call(null,function(){},1):t.call(null)})}},"55dd":function(t,e,i){"use strict";var a=i("5ca1"),n=i("d8e8"),s=i("4bf8"),r=i("79e5"),o=[].sort,l=[1,2,3];a(a.P+a.F*(r(function(){l.sort(void 0)})||!r(function(){l.sort(null)})||!i("2f21")(o)),"Array",{sort:function(t){return void 0===t?o.call(s(this)):o.call(s(this),n(t))}})},8041:function(t,e,i){"use strict";var a=i("d924"),n=i.n(a);n.a},"8b24":function(t,e,i){"use strict";i.r(e);var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("q-page",{staticClass:"flex flex-center"},[i("div",{staticClass:"column self-start justify-center"},[i("div",{staticClass:"row q-gutter-md q-my-md"},[i("q-card",{staticClass:"q-mr-md"},[i("q-card-section",[i("q-scroll-area",{staticStyle:{width:"350px",height:"500px"}},[i("q-markup-table",{attrs:{flat:"",separator:"vertical"}},[i("thead",[i("tr",[i("th",{staticClass:"text-left"},[t._v("倾角读数 (°)")]),i("th",{staticClass:"text-right"},[t._v("实际比重 ("+t._s("p"===t.regData.unit?"°P":"SG")+")")]),i("th",{staticClass:"text-right"},[t._v("拟合误差 ("+t._s("p"===t.regData.unit?"°P":"SG")+")")])])]),i("tbody",t._l(t.tiltData,function(e,a){return i("tr",{key:a},[i("td",{staticClass:"text-left"},[t._v(t._s(e[0].toFixed(2))+"°")]),i("td",{staticClass:"text-right"},[t._v(t._s(e[1].toFixed(3))+t._s("p"===t.regData.unit?"°P":"SG"))]),i("td",{staticClass:"text-right"},[t._v(t._s(t.calcError(e[0],e[1])))])])}),0)])],1)],1)],1),i("q-card",[i("q-card-section",[i("div",{staticStyle:{width:"550px",height:"500px"},attrs:{id:"theChart"}})])],1)],1),i("div",[i("q-card",[i("q-card-section",[i("div",{staticClass:"row q-gutter-md"},[i("q-toggle",{attrs:{label:"比重单位: "+("p"===t.regData.unit?"°P":"SG"),color:"deep-orange","false-value":"sg","true-value":"p",disable:t.tiltData.length>0,"left-label":"","keep-color":""},model:{value:t.regData.unit,callback:function(e){t.$set(t.regData,"unit",e)},expression:"regData.unit"}}),i("q-input",{staticStyle:{width:"140px","font-size":"24px"},attrs:{readonly:"",dense:"",outlined:"",type:"number",label:"倾角读数","input-class":"text-right"},scopedSlots:t._u([{key:"append",fn:function(){return[t._v("°")]},proxy:!0}]),model:{value:t.currentTiltAngle,callback:function(e){t.currentTiltAngle=t._n(e)},expression:"currentTiltAngle"}},[i("q-tooltip",[t._v("自动读取，无需填写")])],1),i("q-input",{staticStyle:{width:"140px","font-size":"24px"},attrs:{autofocus:"",outlined:"",dense:"",type:"number",label:"比重读数","input-class":"text-right"},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handleAddBtn(e)}},scopedSlots:t._u([{key:"append",fn:function(){return[t._v(t._s("p"===t.regData.unit?"°P":"SG"))]},proxy:!0}]),model:{value:t.currentGravityReading,callback:function(e){t.currentGravityReading=t._n(e)},expression:"currentGravityReading"}},[i("q-tooltip",[t._v("填写比重计实际读数")])],1),i("q-btn",{staticClass:"self-center q-ml-sm",attrs:{color:"deep-orange",dense:"",size:"lg",round:"",flat:"",icon:"add_circle_outline"},on:{click:t.handleAddBtn}},[i("q-tooltip",[t._v("添加新数据")])],1),i("q-btn",{staticClass:"self-center q-ml-none",attrs:{color:"blue-9",dense:"",size:"lg",round:"",flat:"",icon:"remove_circle_outline"},on:{click:t.handleRemoveBtn}},[i("q-tooltip",[t._v("删除前一笔数据")])],1),i("q-space"),i("q-toggle",{attrs:{label:"校准助手"},model:{value:t.guideIsOn,callback:function(e){t.guideIsOn=e},expression:"guideIsOn"}}),i("q-btn",{attrs:{disable:t.tiltData.length<5,color:"deep-orange",icon:"save",label:"保存校准结果"},on:{click:t.handleSaveBtn}})],1)])],1)],1)])])},n=[],s=(i("c5f6"),i("55dd"),{name:"PageIndex",created:function(){var t=this;this.handleTiltDataStorage("load"),setInterval(function(){t.updateCurrentTiltAngle()},7e3)},mounted:function(){this.drawChart()},methods:{drawChart:function(){var t=this;this.myRegression=this.$ecstat.regression("polynomial",this.tiltData,2),this.myRegression.points.sort(function(t,e){return t[0]-e[0]});var e=this.$echarts.init(document.getElementById("theChart")),i={tooltip:{trigger:"axis",axisPointer:{type:"cross"}},title:{text:this.chartTitle,subtext:this.formula,subtextStyle:{color:"navy",fontStyle:"italic"},left:"center",top:16},xAxis:{type:"value",name:this.xAxisLabel,nameLocation:"middle",nameGap:30,axisLabel:{formatter:"{value}°"},min:function(t){return Math.floor(.9*t.min)},splitLine:{lineStyle:{type:"dashed"}},splitNumber:10},yAxis:{type:"value",name:this.yAxisLabel,nameLocation:"end",nameGap:18,axisLabel:{formatter:function(e,i){return"p"===t.regData.unit?e.toFixed(1)+" °P":e.toFixed(3)+" SG"}},min:function(e){return"p"===t.regData.unit?0:.99},splitLine:{lineStyle:{type:"dashed"}},splitNumber:10},series:[{name:"scatter",type:"scatter",label:{emphasis:{show:!0}},data:this.tiltData},{name:"line",type:"line",smooth:!0,showSymbol:!1,data:this.myRegression.points,markPoint:{itemStyle:{normal:{color:"transparent"}},label:{normal:{show:!0,position:"left",formatter:this.myRegression.expression,textStyle:{color:"#333",fontSize:14}}},data:[{coord:this.myRegression.points[this.myRegression.points.length-1]}]}}]};e.setOption(i),this.regData.a=this.myRegression.parameter[2],this.regData.b=this.myRegression.parameter[1],this.regData.c=this.myRegression.parameter[0]},calcError:function(t,e){if(this.regData.a&&this.regData.b&&this.regData.c){var i=this.regData.a*t*t+this.regData.b*t+this.regData.c;return(i-e).toFixed(3)}return null},handleAddBtn:function(){this.currentTiltAngle&&Number(this.currentGravityReading)>=0&&(this.tiltData.push([Number(this.currentTiltAngle),Number(this.currentGravityReading)]),this.currentGravityReading=null,this.drawChart(),this.showGuideNotify(),this.handleTiltDataStorage("save"))},handleRemoveBtn:function(){var t=this.tiltData.length-1;t>=0&&(this.tiltData.splice(t,1),this.drawChart(),this.showGuideNotify(),this.handleTiltDataStorage("save"))},handleSaveBtn:function(){var t=this;this.tiltData.length>4&&(this.$axios.post("/calibration",this.regData).then(function(e){t.$q.notify({color:"info",icon:"check_circle_outline",message:"已成功保存校准参数!"})}).catch(function(e){console.log(e),t.$q.notify({color:"negative",icon:"error_outline",message:"Error: 保存校准参数失败!"})}),console.log(this.regData))},updateCurrentTiltAngle:function(){var t=this;this.$axios.get("/calibration").then(function(e){t.currentTiltAngle=e.data.tilt.toFixed(2),t.dismissTiltAngleErrorNotify&&t.dismissTiltAngleErrorNotify()}).catch(function(e){console.log(e),t.dismissTiltAngleErrorNotify||(t.dismissTiltAngleErrorNotify=t.$q.notify({color:"negative",icon:"error_outline",timeout:0,message:"Error: 获取比重计倾角数据失败!"}))})},showGuideNotify:function(){var t;this.dismissGuideNotify&&this.dismissGuideNotify();var e=0,i=this.tiltData.length,a=[0,20,15,10,7.5,5,2.5];for(var n in this.totalWeight=Number(this.plainWaterMl),a)if(n>0&&(e=this.platoCalc(a[n-1],a[n],this.totalWeight),this.totalWeight+=e,Number(n)===i))break;var s=a[i],r=this.calcSgFromPlato(s).toFixed(3);t=0===i?"第".concat(i+1,"步：将电子比重计置于").concat(this.plainWaterMl,"毫升清水中，并记下传统比重计读数（如：").concat(s,"°P，").concat(r,"SG）。"):1===i?"第".concat(i+1,"步：向").concat(this.plainWaterMl,"毫升清水中溶入").concat(Math.round(e),"克白砂糖，使其比重达到约").concat(s,"°P或").concat(r,"SG，并记下传统比重计的实际读数。"):i===a.length?"校准完成：请点击保存按钮保存校准参数。":"第".concat(i+1,"步：往上一步调制的糖溶液中加入").concat(Math.round(e),"毫升清水，将其稀释至约").concat(s,"°P或").concat(r,"SG，并记下传统比重计的实际读数。"),i<a.length+1&&this.guideIsOn&&(this.dismissGuideNotify=this.$q.notify({message:t,color:"negative",textColor:"white",icon:"flag",position:"top-right",timeout:0,multiLine:!1,actions:[{label:"朕知道了",color:"yellow"}],classes:"guideStyle"}))},calcSgFromPlato:function(t){return 1+t/(258.6-t/258.2*227.1)},handleTiltDataStorage:function(t){"save"===t?this.$q.sessionStorage.set("storedTiltData",this.tiltData):"load"===t&&this.$q.sessionStorage.has("storedTiltData")&&(this.tiltData=this.$q.sessionStorage.getItem("storedTiltData"))},handlePopupDialog:function(){var t=this;this.$q.dialog({title:"校准助手",message:"请输入校准所使用的清水容量（毫升）",prompt:{model:this.plainWaterMl,type:"number"},style:"width:300px;"}).onOk(function(e){t.plainWaterMl=e,t.plainWaterMl&&t.showGuideNotify()})},platoCalc:function(t,e,i){var a=e-t;return a>0?i*a/100/(1-e/100):i*t/e-i}},watch:{guideIsOn:function(){this.guideIsOn?this.handlePopupDialog():this.dismissGuideNotify&&this.dismissGuideNotify()}},computed:{formula:function(){return this.tiltData.length>2?"Y = ".concat(this.myRegression.parameter[2].toFixed(8),"·X² ").concat(this.myRegression.parameter[1]>=0?"+":"-"," ").concat(Math.abs(this.myRegression.parameter[1].toFixed(8)),"·X ").concat(this.myRegression.parameter[0]>=0?"+":"-"," ").concat(Math.abs(this.myRegression.parameter[0].toFixed(8))):""}},data:function(){return{currentTiltAngle:null,currentGravityReading:null,myRegression:null,regData:{unit:"p",a:null,b:null,c:null},chartTitle:"Tilt-Gravity Regression",xAxisLabel:"Tilt Degree (°)",yAxisLabel:"Gravity",tiltData:[],dismissGuideNotify:null,dismissTiltAngleErrorNotify:null,guideIsOn:!1,plainWaterMl:400,totalWeight:null}}}),r=s,o=(i("8041"),i("2877")),l=Object(o["a"])(r,a,n,!1,null,null,null);e["default"]=l.exports},d924:function(t,e,i){}}]);